<script lang="ts" module>export const modals = new ModalStack();
</script>

<script lang="ts">import StackedModalContext from './StackedModalContext.svelte';
import { ModalStack } from './modal-stack.svelte';
function isLazyModal(component) {
    return typeof component.prototype === 'undefined';
}
const props = $props();
</script>

{#if modals.stack.length > 0}
  {@render props.backdrop?.(modals)}
{/if}

{#each modals.stack as m, i (m.id)}
  <StackedModalContext modal={m}>
    <!-- lazy modal -->
    {#if isLazyModal(m.component)}
      {#await m.component()}
        {@render props.loading?.(modals)}
      {:then component}
        {#if props.modal}
          {@render props.modal({ component: component.default, props: m.props }, modals)}
        {:else}
          <component.default {...m.props} />
        {/if}
      {/await}
    {:else}
      <!-- normal modal -->
      {#if props.modal}
        {@render props.modal({ component: m.component, props: m.props }, modals)}
      {:else}
        <m.component {...m.props} />
      {/if}
    {/if}
  </StackedModalContext>
{/each}
